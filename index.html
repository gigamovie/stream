<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GIGA21 Ultra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap');
        body { background: #050505; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-user-select: none; overflow-x: hidden; }
        .gold-gradient { background: linear-gradient(135deg, #bf953f 0%, #fcf6ba 50%, #aa771c 100%); }
        .gold-text { background: linear-gradient(to right, #bf953f, #fcf6ba, #aa771c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .bottom-nav { background: rgba(10, 10, 10, 0.85); backdrop-filter: blur(20px); border-top: 1px solid rgba(191, 149, 63, 0.2); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Thumbnail Standard */
        .movie-card { flex: 0 0 130px; width: 130px; }
        .movie-card img, .grid-img { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 1rem; }
        
        /* Title Control */
        .title-clamp { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.2; height: 2.4em; }
        
        /* Shimmer Effect */
        .shimmer { background: linear-gradient(90deg, #111 25%, #1a1a1a 50%, #111 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

        /* Country & Load More Cards */
        .country-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(191, 149, 63, 0.1); }
        .flag-icon { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(191, 149, 63, 0.3); }
        
        .load-more-card {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center Horizontal */
            justify-content: center; /* Center Vertikal */
            text-align: center;
            background: linear-gradient(135deg, rgba(191, 149, 63, 0.1), rgba(5, 5, 5, 1));
            border: 1px dashed rgba(191, 149, 63, 0.4);
            border-radius: 1.25rem;
            aspect-ratio: 2/3;
            width: 100%; /* Pastikan mengisi penuh grid */
            cursor: pointer;
        }

        .player-panel { border-radius: 24px 24px 0 0; background: #0f0f0f; border-top: 1px solid rgba(191, 149, 63, 0.3); }
        
        footer { border-top: 1px solid rgba(191, 149, 63, 0.1); }
        
        /* Overlay Background */
        #download-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 500;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* Modal Box */
        .dl-box {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 1px solid rgba(191, 149, 63, 0.3);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        
        .dl-info-row {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 12px;
            color: #888;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 8px;
        }
        
        .dl-info-row b { color: #fff; }
        
        /* Buttons */
        .btn-dl-real {
            display: none; /* Sembunyi sampai timer habis */
            width: 100%;
            background: linear-gradient(to right, #bf953f, #fcf6ba, #aa771c);
            color: black;
            font-weight: 900;
            padding: 15px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 15px;
            box-shadow: 0 10px 20px rgba(191,149,63,0.3);
        }
        
        .fake-ad-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #ccc;
            font-size: 10px;
            font-weight: 800;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .text-warning-vpn { font-size: 9px; opacity: 0.5; line-height: 1.4; }
        
    </style>
</head>
<body class="pb-24">

<!-- HEADER -->
<header class="fixed top-0 inset-x-0 z-[100] px-5 py-5 flex justify-between items-center bg-gradient-to-b from-black via-black/50 to-transparent">
    <h1 class="text-2xl font-black gold-text uppercase tracking-tighter" onclick="location.reload()">GIGA21</h1>
    
    <div class="flex items-center gap-4">
        <div onclick="toggleAdultMode()" id="adult-toggle" class="relative w-10 h-5 bg-white/10 rounded-full border border-white/10 transition-all duration-500 cursor-pointer">
            <div id="adult-dot" class="absolute top-1 left-1 w-2.5 h-2.5 bg-gray-500 rounded-full transition-all duration-500 flex items-center justify-center">
                <span id="adult-label" class="absolute -top-5 text-[7px] font-black text-gray-500 tracking-widest opacity-0 transition-opacity">ULTRA</span>
            </div>
        </div>

        <div class="w-7 h-7 rounded-full gold-gradient flex items-center justify-center shadow-lg" onclick="toggleSearch()">
            <i class="fas fa-search text-black text-sm"></i>
        </div>
    </div>
</header>

<!-- OVERLAY SEARCH -->
    <div id="search-overlay" class="fixed inset-0 z-[200] bg-black/95 hidden p-6 overflow-y-auto no-scrollbar">
        <div class="flex items-center gap-4 mb-8 pt-4">
            <i class="fas fa-arrow-left text-xl text-[#bf953f]" onclick="toggleSearch()"></i>
            <input id="search-input" type="text" placeholder="Cari film..." class="w-full bg-transparent border-b border-[#bf953f] py-3 outline-none text-xl font-bold">
        </div>
        <div id="search-results" class="grid grid-cols-3 gap-3"></div>
    </div>

<!-- HERO | BUTTON MULAI NONTON -->
    <section class="relative h-[60vh] w-full flex items-end p-6 overflow-hidden">
        <div id="hero-bg" class="absolute inset-0 z-0 bg-cover bg-center scale-110 transition-all duration-1000"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-[#050505] via-[#050505]/20 to-transparent z-10"></div>
        <div class="relative z-20 w-full pb-4">
            <h2 id="hero-title" class="text-4xl font-black mb-3 leading-tight uppercase tracking-tighter">...</h2>
            <div class="flex gap-3 mb-6">
                <span class="text-[10px] bg-white/10 px-3 py-1.5 rounded-lg font-bold backdrop-blur-md border border-white/10 text-white/60">ULTRA HD 4K</span>
                <span id="hero-year" class="text-[10px] gold-bg text-black px-3 py-1.5 rounded-lg font-black gold-gradient">2026</span>
            </div>
            <div class="flex gap-3">
<button onclick="smartOpenPlayer(event)" class="flex-1 py-3 rounded-xl bg-white text-black font-black text-xs flex items-center justify-center gap-2 active:scale-95 transition">
    <i class="fas fa-play text-[10px]"></i> MULAI NONTON
</button>
                <button id="btn-save-hero" onclick="toggleFavoriteHero()" class="w-12 h-12 rounded-xl bg-white/10 backdrop-blur-xl flex items-center justify-center border border-white/10 active:scale-95 transition">
                    <i class="fas fa-plus transition-all duration-300"></i>
                </button>
            </div>
        </div>
    </section>

<!-- MENU DROPDOWN -->
    <div class="px-5 mb-8 grid grid-cols-2 gap-3 relative z-[50] -mt-4">
        <div class="relative">
            <button onclick="toggleDropdown('dropdown-country')" class="w-full py-3.5 px-4 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-between active:scale-95 transition backdrop-blur-xl">
                <div class="flex items-center gap-2 overflow-hidden">
                    <i class="fas fa-globe-asia text-[10px] gold-text"></i>
                    <span id="label-country" class="text-[10px] font-black uppercase tracking-widest opacity-80 truncate">Negara</span>
                </div>
                <i id="icon-country" class="fas fa-chevron-down text-[8px] opacity-40 transition-transform"></i>
            </button>
            <div id="dropdown-country" class="hidden absolute top-full left-0 right-0 mt-2 bg-[#0f0f0f] border border-white/10 rounded-2xl shadow-2xl z-[100] max-h-[250px] overflow-y-auto no-scrollbar p-2"></div>
        </div>

        <div class="relative">
            <button onclick="toggleDropdown('dropdown-genre')" class="w-full py-3.5 px-4 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-between active:scale-95 transition backdrop-blur-xl">
                <div class="flex items-center gap-2 overflow-hidden">
                    <i class="fas fa-film text-[10px] gold-text"></i>
                    <span id="label-genre" class="text-[10px] font-black uppercase tracking-widest opacity-80 truncate">Genre</span>
                </div>
                <i id="icon-genre" class="fas fa-chevron-down text-[8px] opacity-40 transition-transform"></i>
            </button>
            <div id="dropdown-genre" class="hidden absolute top-full left-0 right-0 mt-2 bg-[#0f0f0f] border border-white/10 rounded-2xl shadow-2xl z-[100] max-h-[250px] overflow-y-auto no-scrollbar p-2"></div>
        </div>
    </div>

<!-- LIST VIDEO -->
    <main class="px-5 space-y-6">
        <div class="flex items-center justify-between border-b border-white/5 pb-4">
            <h3 id="grid-title" class="text-[11px] font-black uppercase tracking-[0.2em] gold-text">Trending Sekarang</h3>
            <span id="movie-count" class="text-[9px] font-bold text-gray-600">PREMIUM SELECTION</span>
        </div>
        <div id="main-grid" class="grid grid-cols-3 gap-3 min-h-screen">
            </div>
    </main>

<!-- FOOTER -->
    <footer class="mt-20 glass py-10 px-6">
        <div class="max-w-6xl mx-auto grid md:grid-cols-3 gap-10 text-center md:text-left">
            <div>
                <h1 class="text-2xl font-black gold-text mb-4 uppercase">GIGA21</h1>
                <p class="text-xs text-gray-500 leading-relaxed">Portal streaming film dan series kualitas HD gratis. Nikmati ribuan konten premium tanpa biaya berlangganan.</p>
            </div>
            <div class="flex flex-col gap-3">
                <h4 class="text-[10px] font-bold uppercase gold-text tracking-widest">Navigasi</h4>
                <a href="about.html" class="text-xs text-gray-400 hover:text-white">Tentang Kami</a>
                <a href="dmca.html" class="text-xs text-gray-400 hover:text-white">DMCA Konten</a>
                <a href="privasi.html" class="text-xs text-gray-400 hover:text-white">Kebijakan Privasi</a>
            </div>
            <div>
                <h4 class="text-[10px] font-bold uppercase gold-text tracking-widest mb-4">Ikuti Kami</h4>
                <div class="flex justify-center md:justify-start gap-4">
                    <a href="https://t.me/username_anda" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110">
                        <i class="fab fa-telegram text-xl hover:text-[#bf953f] cursor-pointer"></i>
                    </a>
            
                    <a href="https://instagram.com/username_anda" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110">
                        <i class="fab fa-instagram text-xl hover:text-[#bf953f] cursor-pointer"></i>
                    </a>
            
                    <a href="https://twitter.com/username_anda" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110">
                        <i class="fab fa-twitter text-xl hover:text-[#bf953f] cursor-pointer"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="text-center mt-10 pt-6 border-t border-white/5">
            <p class="text-[9px] text-gray-600 uppercase tracking-widest">&copy; 2026 GIGA21 Gold. All Rights Reserved.</p>
        </div>
    </footer>

<!-- VIDEO PLAYER | DETAIL MOVIE -->
<div id="player-screen" class="fixed inset-0 z-[300] bg-black hidden flex flex-col overflow-y-auto no-scrollbar">
    <div class="sticky top-0 z-10 p-6 flex items-center justify-between bg-black/80 backdrop-blur-md">
        <i class="fas fa-chevron-down text-2xl text-gray-400 hover:text-white cursor-pointer" onclick="closePlayer()"></i>
        <span class="text-[12px] font-black gold-text tracking-[0.3em] uppercase">Ultra Cinema Mode</span>
        <div class="w-6"></div>
    </div>

    <div class="max-w-6xl mx-auto w-full">
        
        <div class="w-full aspect-video bg-black shadow-2xl">
            <iframe id="ultra-player" src="" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
        </div>

        <div class="p-6 md:p-10 flex flex-col md:flex-row gap-8">
            
            <div class="hidden md:block w-64 shrink-0">
                <img id="player-poster" src="" class="w-full rounded-2xl shadow-2xl border border-white/10 sticky top-24">
            </div>

            <div class="flex-1">
                <div id="server-list" class="grid grid-cols-3 sm:grid-cols-6 gap-2 mb-8"></div>

                <div class="flex gap-4 items-start mb-6">
                    <img id="player-poster-mobile" src="" class="md:hidden w-24 rounded-lg shadow-lg border border-white/10">
                    <div>
                        <h2 id="player-title" class="text-2xl md:text-4xl font-black mb-3 leading-tight tracking-tighter">...</h2>
                        <div class="flex flex-wrap items-center gap-3 text-[10px] font-black uppercase tracking-widest">
                            <span id="player-rating" class="text-[#bf953f]">⭐ 0.0</span>
                            <span class="text-white/20">|</span>
                            <span id="player-year" class="text-gray-400">2026</span>
                            <span class="text-white/20">|</span>
                            <span id="player-duration" class="bg-white/10 px-2 py-0.5 rounded text-white">0 MIN</span>
                        </div>
                    </div>
                </div>

                <div id="player-genres" class="flex flex-wrap gap-2 mb-6"></div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <p class="text-[10px] font-black text-[#bf953f] uppercase tracking-[0.2em] mb-2 opacity-50">Sinopsis</p>
                        <p id="player-desc" class="text-sm text-gray-400 leading-relaxed"></p>
                    </div>
                    
                    <div class="flex flex-col gap-3">
                        <button onclick="openDownloadOverlay()" class="w-full py-4 rounded-2xl bg-gradient-to-r from-[#bf953f] to-[#aa771c] text-black font-black uppercase tracking-widest active:scale-95 transition-all shadow-lg flex items-center justify-center gap-2">
                            <i class="fas fa-download text-lg"></i> Download Movie
                        </button>
                        <button onclick="shareMovie()" class="w-full py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-black uppercase tracking-widest active:scale-95 transition-all flex items-center justify-center gap-2 hover:bg-white/10">
                            <i class="fas fa-share-alt text-lg"></i> Bagikan Link
                        </button>
                    </div>
                </div>

                <div class="mt-10">
                    <p class="text-[10px] font-black text-[#bf953f] uppercase tracking-[0.2em] mb-4 opacity-50">Cast Utama</p>
                    <div id="player-cast" class="flex gap-4 overflow-x-auto no-scrollbar pb-4"></div>
                </div>

                <div class="mt-10 border-t border-white/5 pt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-[12px] font-black gold-text uppercase tracking-[0.2em]">Eksklusif Untuk Anda</h3>
                        <button onclick="viewAllAdult()" class="text-[10px] text-gray-500 font-bold hover:text-[#bf953f] transition">
                            VIEW ALL <i class="fas fa-chevron-right ml-1 text-[8px]"></i>
                        </button>
                    </div>
                    <div id="recom-grid" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 gap-3"></div>
                </div>
            </div> </div> </div> </div>
    
<!-- OVERLAY DOWNLOAD -->
<div id="download-overlay" onclick="closeDownloadOverlay(event)">
    <div class="dl-box" onclick="event.stopPropagation()">
        <h5 class="font-black mb-4 text-center gold-text uppercase tracking-widest text-sm">Link Download Aman</h5>
        
        <div class="dl-info-row"><span>Nama File:</span><b id="dl-filename">Loading...</b></div>
        <div class="dl-info-row"><span>Status:</span><b class="text-green-500">Tersedia</b></div>
<div class="dl-info-row flex items-center justify-between">
    <span>Kualitas Tersedia:</span>
    <div class="flex gap-1 items-center">
        <span class="flex items-center justify-center px-2 py-1 bg-white/5 border border-white/10 rounded text-[7px] font-black text-gray-400">360P</span>
        <span class="flex items-center justify-center px-2 py-1 bg-white/5 border border-white/10 rounded text-[7px] font-black text-gray-400">480P</span>
        
        <span class="flex items-center justify-center px-2 py-1 bg-blue-500/10 border border-blue-500/30 rounded text-[7px] font-black text-blue-400">720P HD</span>
        
        <span class="flex items-center justify-center px-2 py-1 bg-gradient-to-br from-[#bf953f] to-[#aa771c] rounded text-[7px] font-black text-black shadow-lg shadow-yellow-900/20">1080P FHD</span>
        
        <span class="flex items-center justify-center px-2 py-1 bg-red-600/20 border border-red-600/50 rounded text-[7px] font-black text-red-500 animate-pulse">4K UHD</span>
    </div>
</div>
    
        <div id="timer-wrapper" class="mt-6 text-center">
            <div id="countdown-text" class="text-[10px] text-gray-400 font-bold uppercase tracking-normal">
                Menyiapkan link dalam <span id="dl-timer" class="text-red-500 mx-1">15</span> detik...
            </div>
        
            <button class="btn-dl-real" id="real-dl-btn" onclick="triggerDownload()">
                DOWNLOAD SEKARANG
            </button>
        </div>

<div class="mt-4">
    <div class="fake-ad-btn" onclick="goToServer('High Speed Ads', '2.4 GB')">
        <i class="fas fa-bolt text-yellow-500 mr-1"></i> DOWNLOAD HIGH SPEED (ADS)
    </div>
    
    <div class="fake-ad-btn" onclick="goToServer('USA Mirror Server', '2.4 GB')">
        <i class="fas fa-server mr-1"></i> SERVER MIRROR (USA)
    </div>
</div>
        
        <p class="text-center mt-4 text-warning-vpn">
            *Gunakan VPN jika link tidak dapat diakses. Selesaikan verifikasi jika diminta.
        </p>
    </div>
</div>

<!-- OVERLAY DOWNLOAD SEKARANG -->
<div id="gateway-overlay" class="fixed inset-0 z-[600] bg-black/95 backdrop-blur-xl hidden flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-[#0f0f0f] border border-white/10 rounded-3xl p-6 shadow-2xl">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-sm font-black gold-text uppercase tracking-widest">Pilih Resolusi Unduhan</h3>
            <i class="fas fa-times text-gray-500" onclick="closeGateway()"></i>
        </div>

        <div class="space-y-3" id="quality-list">
            <button onclick="goToFinalDownload('360p', '320MB')" class="w-full flex items-center justify-between p-4 bg-white/5 hover:bg-white/10 border border-white/5 rounded-2xl transition group">
                <div class="text-left">
                    <p class="text-xs font-black text-white">LOW QUALITY (360p)</p>
                    <p class="text-[10px] text-gray-500">Hemat Kuota • 320 MB</p>
                </div>
                <i class="fas fa-chevron-right text-gray-700 group-hover:text-[#bf953f]"></i>
            </button>

            <button onclick="goToFinalDownload('480p', '550MB')" class="w-full flex items-center justify-between p-4 bg-white/5 hover:bg-white/10 border border-white/5 rounded-2xl transition group">
                <div class="text-left">
                    <p class="text-xs font-black text-white">STANDARD (480p)</p>
                    <p class="text-[10px] text-gray-500">Kualitas Mobile • 550 MB</p>
                </div>
                <i class="fas fa-chevron-right text-gray-700 group-hover:text-[#bf953f]"></i>
            </button>

            <button onclick="goToFinalDownload('720p', '1.1GB')" class="w-full flex items-center justify-between p-4 bg-blue-500/5 hover:bg-blue-500/10 border border-blue-500/20 rounded-2xl transition group">
                <div class="text-left">
                    <p class="text-xs font-black text-blue-400">HIGH DEFINITION (720p)</p>
                    <p class="text-[10px] text-gray-500">Jernih & Tajam • 1.1 GB</p>
                </div>
                <i class="fas fa-download text-blue-400"></i>
            </button>

            <button onclick="goToFinalDownload('1080p', '2.4GB')" class="w-full flex items-center justify-between p-4 bg-[#bf953f]/10 hover:bg-[#bf953f]/20 border border-[#bf953f]/30 rounded-2xl transition group">
                <div class="text-left">
                    <p class="text-xs font-black gold-text">FULL HD (1080p)</p>
                    <p class="text-[10px] text-gray-500 text-yellow-600/70">Kualitas Bioskop • 2.4 GB</p>
                </div>
                <i class="fas fa-crown gold-text"></i>
            </button>

            <button onclick="window.open('https://practicalboil.com/bvrnh9xigu?key=ba748d14a1fc94f5942aea0574acdd95', '_blank')" class="w-full flex items-center justify-between p-4 bg-red-600/10 border border-red-600/30 rounded-2xl animate-pulse">
                <div class="text-left">
                    <p class="text-xs font-black text-red-500">ULTRA HD 4K (ADS)</p>
                    <p class="text-[10px] text-red-700/70">Uncompressed • 12.8 GB</p>
                </div>
                <i class="fas fa-bolt text-red-500"></i>
            </button>
        </div>
        
        <p class="mt-6 text-[9px] text-center text-gray-600 uppercase font-bold tracking-tighter">
            Klik salah satu kualitas untuk diarahkan ke MediaShare Cloud
        </p>
    </div>
</div>

</body>

<script>
const API_KEY = '0ac7d6475232e17859d8e46b5dc9a435';
const BASE_URL = 'https://api.themoviedb.org/3';
const IMG_URL = 'https://image.tmdb.org/t/p/w500';
let isAdultMode = false;
let currentEndpoint = '/trending/all/day?';
let currentViewPage = 1;
let featuredType = 'movie';
let featuredId = '';
let hasClickedAd = sessionStorage.getItem('hero_ad_done') === 'true';
let currentPlayingId = '';
let currentPlayingType = '';


const countries = [
    { id: 'ID', name: 'Indonesia', code: 'id' },
    { id: 'KR', name: 'Korea', code: 'kr' },
    { id: 'JP', name: 'Jepang', code: 'jp' },
    { id: 'PH', name: 'Philippines', code: 'pn' },
    { id: 'TH', name: 'Thailand', code: 'th' },
    { id: 'CN', name: 'China', code: 'cn' },
    { id: 'HK', name: 'Hongkong', code: 'hk' },
    { id: 'IN', name: 'India', code: 'in' },
    { id: 'TR', name: 'Turki', code: 'tr' },
    { id: 'US', name: 'USA', code: 'us' },
    { id: 'FR', name: 'Prancis', code: 'fr' },
    { id: 'ES', name: 'Spanyol', code: 'es' },
    { id: 'IT', name: 'Italy', code: 'it' },
    { id: 'GB', name: 'Inggris', code: 'gb' },
    { id: 'RU', name: 'Rusia', code: 'ru' }
];

const adultMovies = ['1242011', '130150', '1422211', '1331072', '1285807', '1297645', '290098', '9769','1064213','858024', '10497', '48650', '276126', '729097', '700566', '746381', '452073'];

// --- FUNGSI BARU UNTUK HOME FILTER ---
async function renderSpecificMovies(ids) {
    const container = document.getElementById('main-grid');
    container.innerHTML = '<div class="col-span-3 py-10 text-center"><i class="fas fa-spinner fa-spin gold-text text-2xl"></i></div>';
    
    const results = [];
    for (const id of ids) {
        try {
            const res = await fetch(`${BASE_URL}/movie/${id}?api_key=${API_KEY}`);
            const data = await res.json();
            if (data.id) results.push(data);
        } catch (e) { console.error("Error fetch ID:", id); }
    }
    
    // Tampilkan 16 film pilihan
    renderGrid({ results: results, page: 1, total_pages: 2 }, 'main-grid', false);
    
    // Paksa currentViewPage ke 1 agar loadMoreData mulai dari page 1 discover
    currentViewPage = 1;
}

function viewAllAdult() {
    sessionStorage.setItem('filter_mode', 'adult_exclusive');
    window.location.href = 'index.html';
}

async function renderRecommendations() {
    const grid = document.getElementById('recom-grid');
    if (!grid) return;
    
    // 1. Tampilkan loading skeleton atau kosongkan dulu
    grid.innerHTML = '<div class="col-span-3 text-center py-4 opacity-50 text-[10px]">MEMUAT REKOMENDASI...</div>';

    // 2. Ambil 9 ID acak
    const shuffledIds = [...adultMovies].sort(() => 0.5 - Math.random()).slice(0, 9);

    try {
        // 3. Ambil SEMUA data film sekaligus (Parallel Fetching)
        const moviePromises = shuffledIds.map(id => 
            fetch(`${BASE_URL}/movie/${id}?api_key=${API_KEY}`).then(res => res.json())
        );

        const movies = await Promise.all(moviePromises);

        // 4. Gabungkan semua HTML jadi satu string (Lebih cepat daripada innerHTML += berkali-kali)
        const htmlContent = movies.map(movie => {
            if (!movie.poster_path) return '';
            
            return `
                <div onclick="openPlayer('${movie.id}', 'movie')" class="relative aspect-[2/3] rounded-lg overflow-hidden border border-white/5 cursor-pointer group shadow-lg bg-white/5">
                    <img src="${IMG_URL + movie.poster_path}" 
                         loading="lazy"
                         class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-90"></div>
                    
                    <div class="absolute bottom-1.5 left-2 right-2">
                        <p class="text-[8px] text-white font-black truncate uppercase tracking-tighter leading-none">${movie.title}</p>
                    </div>
                </div>
            `;
        }).join('');

        // 5. Tampilkan ke grid sekaligus
        grid.innerHTML = htmlContent;

    } catch (error) {
        console.error("Gagal memuat rekomendasi:", error);
        grid.innerHTML = '';
    }
}

// --- SMART OPEN PLAYER (TENTANG IKLAN HERO) ---
function smartOpenPlayer(e) {
    const btn = e.currentTarget;
    const adLink = 'https://practicalboil.com/znjavc1n?key=583459b5819904ac09a2ecdfae8db7ed';

    if (!hasClickedAd) {
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin text-[10px]"></i> LOADING SERVER...';
        btn.style.pointerEvents = 'none';

        window.open(adLink, '_blank');
        hasClickedAd = true;
        sessionStorage.setItem('hero_ad_done', 'true');

        setTimeout(() => {
            btn.innerHTML = originalContent;
            btn.style.pointerEvents = 'auto';
            alert("SERVER READY: Silakan klik 'MULAI NONTON' sekali lagi.");
        }, 1500);
    } else {
        playHero();
    }
}

async function initApp() {
    // 1. CEK PARAMETER DI URL (PENTING UNTUK FITUR SHARE)
    const urlParams = new URLSearchParams(window.location.search);
    const sharedId = urlParams.get('id');
    const sharedType = urlParams.get('type');
    const mode = sessionStorage.getItem('filter_mode');
    
    // 2. LOAD DATA HERO (Tetap jalan agar background tampil)
    const res = await fetch(`${BASE_URL}/trending/all/day?api_key=${API_KEY}`);
    const data = await res.json();
    const feat = data.results[0];
    
    featuredId = feat.id;
    featuredType = feat.media_type || 'movie';
    
    document.getElementById('hero-bg').style.backgroundImage = `url('https://image.tmdb.org/t/p/original${feat.backdrop_path}')`;
    document.getElementById('hero-title').innerText = feat.title || feat.name;
    document.getElementById('hero-year').innerText = (feat.release_date || feat.first_air_date || '2026').split('-')[0];

    // 3. LOGIKA RENDER GRID (Eksklusif vs Normal)
    if (mode === 'adult_exclusive') {
        document.getElementById('grid-title').innerText = "EKSKLUSIF UNTUK ANDA";
        currentEndpoint = `/search/movie?query=adult&`; 
        renderSpecificMovies(adultMovies);
    } else {
        renderGrid(data, 'main-grid', false);
    }

    // 4. LOGIKA AUTO-OPEN (Jika user datang dari Link Share)
    if (sharedId && sharedType) {
        // Beri sedikit delay agar halaman siap sebelum overlay muncul
        setTimeout(() => {
            openPlayer(sharedId, sharedType);
            
            // Opsional: Bersihkan URL agar saat di-refresh tidak buka player terus
            window.history.replaceState({}, document.title, window.location.pathname);
        }, 800);
    }
    
    renderDropdownMenus();
}

// --- FUNGSI LAINNYA (TETAP SAMA) ---

function toggleAdultMode() {
    isAdultMode = !isAdultMode;
    const dot = document.getElementById('adult-dot');
    const toggle = document.getElementById('adult-toggle');
    const label = document.getElementById('adult-label');
    if (isAdultMode) {
        toggle.classList.replace('bg-white/10', 'bg-red-900/30'); toggle.classList.add('border-red-500/50');
        dot.classList.replace('bg-gray-500', 'bg-red-500'); dot.style.left = '24px';
        label.classList.replace('text-gray-500', 'text-red-500'); label.classList.remove('opacity-0');
        label.innerText = "18+";
    } else {
        toggle.classList.replace('bg-red-900/30', 'bg-white/10'); toggle.classList.remove('border-red-500/50');
        dot.classList.replace('bg-red-500', 'bg-gray-500'); dot.style.left = '4px';
        label.classList.add('opacity-0');
    }
    applyFilter(activeFilters.country ? 'country' : 'init', activeFilters.country || '', activeFilters.countryName || 'Trending');
}

function renderGrid(data, containerId, isAppend = false) {
    const container = document.getElementById(containerId);
    if (!isAppend) { container.innerHTML = ''; currentViewPage = 1; }
    const oldCard = document.getElementById('next-page-card');
    if (oldCard) oldCard.remove();

    const html = data.results.filter(m => m.poster_path).map(m => `
        <div class="w-full active:scale-95 transition mb-3" onclick="openPlayer('${m.id}', '${m.media_type || 'movie'}')">
            <div class="relative overflow-hidden rounded-2xl border border-white/5 shadow-2xl">
                <img src="${IMG_URL + m.poster_path}" class="grid-img">
                <div class="absolute top-2 right-2 bg-black/70 backdrop-blur-md px-1.5 py-0.5 rounded text-[8px] font-black gold-text">⭐ ${m.vote_average.toFixed(1)}</div>
            </div>
            <p class="text-[9px] mt-2 font-black uppercase text-center title-clamp opacity-80">${m.title || m.name}</p>
        </div>
    `).join('');
    container.insertAdjacentHTML('beforeend', html);

    if (data.page < data.total_pages || sessionStorage.getItem('filter_mode') === 'adult_exclusive') {
        container.insertAdjacentHTML('beforeend', `
            <div id="next-page-card" onclick="loadMoreData()" class="load-more-card active:scale-90 transition">
                <div class="flex flex-col items-center justify-center w-full h-full">
                    <div class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center mb-2 shadow-lg">
                        <i class="fas fa-plus text-black text-xs"></i>
                    </div>
                    <span class="text-[8px] font-black gold-text tracking-widest uppercase">Lihat Lainnya</span>
                </div>
            </div>
        `);
        currentViewPage = isAppend ? data.page + 1 : 1; 
    }

    
}

async function loadMoreData() {
    const card = document.getElementById('next-page-card');
    card.innerHTML = `<i class="fas fa-circle-notch fa-spin gold-text text-xl"></i>`;
    
    const target = !document.getElementById('search-overlay').classList.contains('hidden') ? 'search-results' : 'main-grid';
    
    // Ambil data berdasarkan currentEndpoint yang sudah kita set ('/search/movie?query=adult&')
    const res = await fetch(`${BASE_URL}${currentEndpoint}${currentEndpoint.includes('?') ? '' : '?'}api_key=${API_KEY}&include_adult=true&page=${currentViewPage}`);
    const data = await res.json();
    
    renderGrid(data, target, true);

    // Update judul grid setelah hasil pencarian muncul agar user tahu list sudah bertambah
    if (sessionStorage.getItem('filter_mode') === 'adult_exclusive') {
        document.getElementById('grid-title').innerText = "HASIL TEMUAN EKSKLUSIF";
        sessionStorage.removeItem('filter_mode'); 
    }
}

document.getElementById('search-input').addEventListener('input', async (e) => {
    const q = e.target.value;
    const resultsContainer = document.getElementById('search-results');
    if (q.length < 3) { resultsContainer.innerHTML = ''; return; }
    currentEndpoint = `/search/multi?query=${encodeURIComponent(q)}&`;
    currentViewPage = 1;
    const res = await fetch(`${BASE_URL}${currentEndpoint}api_key=${API_KEY}&include_adult=${isAdultMode}&page=${currentViewPage}`);
    const data = await res.json();
    renderGrid(data, 'search-results', false);
});

function toggleDropdown(id) {
    const menus = ['dropdown-country', 'dropdown-genre'];
    menus.forEach(m => {
        const el = document.getElementById(m);
        const icon = document.getElementById('icon-' + m.replace('dropdown-', ''));
        if (m === id) {
            const isHidden = el.classList.contains('hidden');
            el.classList.toggle('hidden');
            if(icon) icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
        } else {
            el.classList.add('hidden');
            const otherIcon = document.getElementById('icon-' + m.replace('dropdown-', ''));
            if(otherIcon) otherIcon.style.transform = 'rotate(0deg)';
        }
    });
}

async function renderDropdownMenus() {
    const countryMenu = document.getElementById('dropdown-country');
    if(countryMenu) {
        countryMenu.innerHTML = `
            <div onclick="applyFilter('country', '', 'Negara')" class="p-3 hover:bg-red-500/10 rounded-xl transition cursor-pointer mb-2 border-b border-white/5 flex items-center gap-2 group">
                <i class="fas fa-undo-alt text-[10px] text-red-500 group-hover:rotate-[-45deg] transition-transform"></i>
                <span class="text-[10px] font-black uppercase tracking-widest text-red-500">Reset Negara</span>
            </div>
        ` + countries.map(c => `
            <div onclick="applyFilter('country', '${c.id}', '${c.name}')" class="flex items-center gap-3 p-3 hover:bg-white/5 rounded-xl transition cursor-pointer mb-1">
                <img src="https://flagcdn.com/w40/${c.code}.png" class="w-4 h-4 rounded-full object-cover">
                <span class="text-[10px] font-bold uppercase tracking-tighter opacity-70">${c.name}</span>
            </div>
        `).join('');
    }

    const genreRes = await fetch(`${BASE_URL}/genre/movie/list?api_key=${API_KEY}`);
    const genreData = await genreRes.json();
    const genreMenu = document.getElementById('dropdown-genre');
    if(genreMenu) {
        genreMenu.innerHTML = `
            <div onclick="applyFilter('genre', '', 'Genre')" class="p-3 hover:bg-red-500/10 rounded-xl transition cursor-pointer mb-2 border-b border-white/5 flex items-center gap-2 group">
                <i class="fas fa-trash-alt text-[10px] text-red-500 group-hover:scale-110 transition-transform"></i>
                <span class="text-[10px] font-black uppercase tracking-widest text-red-500">Reset Genre</span>
            </div>
        ` + genreData.genres.map(g => `
            <div onclick="applyFilter('genre', '${g.id}', '${g.name}')" class="p-3 hover:bg-white/5 rounded-xl transition cursor-pointer mb-1">
                <span class="text-[10px] font-bold uppercase tracking-tighter opacity-70">${g.name}</span>
            </div>
        `).join('');
    }
}

let activeFilters = { country: '', genre: '', countryName: '', genreName: '' };

async function applyFilter(type, id, name) {
    toggleDropdown('none');
    if (type === 'country') {
        activeFilters.country = id; activeFilters.countryName = name;
        document.getElementById('label-country').innerText = name;
        document.getElementById('label-country').classList.add('gold-text');
    } else if (type === 'genre') {
        activeFilters.genre = id; activeFilters.genreName = name;
        document.getElementById('label-genre').innerText = name;
        document.getElementById('label-genre').classList.add('gold-text');
    }
    const displayCountry = activeFilters.countryName || "Semua Negara";
    const displayGenre = activeFilters.genreName || "Semua Genre";
    document.getElementById('grid-title').innerText = `${displayGenre} • ${displayCountry}`;

    let filterParams = '';
    if (activeFilters.country) filterParams += `&with_origin_country=${activeFilters.country}`;
    if (activeFilters.genre) filterParams += `&with_genres=${activeFilters.genre}`;

    currentEndpoint = !filterParams ? '/trending/all/day?' : `/discover/movie?${filterParams.substring(1)}&`;
    currentViewPage = 1;
    const res = await fetch(`${BASE_URL}${currentEndpoint}${currentEndpoint.includes('?') ? '' : '?'}api_key=${API_KEY}&include_adult=${isAdultMode}&page=${currentViewPage}`);
    const data = await res.json();
    renderGrid(data, 'main-grid', false);
    window.scrollTo({ top: window.innerHeight * 0.4, behavior: 'smooth' });
}

async function openPlayer(id, type) {
    currentPlayingId = id;
    currentPlayingType = type;
    const screen = document.getElementById('player-screen');
    screen.classList.remove('hidden');
    const res = await fetch(`${BASE_URL}/${type}/${id}?api_key=${API_KEY}&append_to_response=credits`);
    const data = await res.json();
    const posterURL = data.poster_path ? IMG_URL + data.poster_path : 'path-to-placeholder.jpg';
    
    document.getElementById('player-poster').src = posterURL;
    document.getElementById('player-poster-mobile').src = posterURL;
    document.getElementById('player-title').innerText = data.title || data.name;
    document.getElementById('player-desc').innerText = data.overview || "Tidak ada sinopsis.";
    document.getElementById('player-rating').innerText = `⭐ ${data.vote_average.toFixed(1)}`;
    document.getElementById('player-year').innerText = (data.release_date || data.first_air_date || '2026').split('-')[0];
    const runtime = data.runtime || (data.episode_run_time ? data.episode_run_time[0] : 0);
    document.getElementById('player-duration').innerText = runtime > 0 ? `${runtime} MIN` : 'N/A';

    document.getElementById('player-genres').innerHTML = data.genres.map(g => `
        <span class="text-[9px] font-black px-3 py-1 border border-white/10 rounded-full text-gray-400 uppercase">${g.name}</span>
    `).join('');

    const cast = data.credits.cast.slice(0, 8);
    document.getElementById('player-cast').innerHTML = cast.map(c => `
        <div class="flex-shrink-0 w-16 text-center">
            <div class="w-16 h-16 rounded-full border border-white/10 overflow-hidden mb-2">
                <img src="${c.profile_path ? 'https://image.tmdb.org/t/p/w200' + c.profile_path : 'https://via.placeholder.com/200x200?text=No+Img'}" class="w-full h-full object-cover">
            </div>
            <p class="text-[8px] font-black text-white truncate w-full">${c.name.split(' ')[0]}</p>
        </div>
    `).join('');

    const servers = [
        {n: 'SERVER 1', u: `https://vidsrc.to/embed/${type}/${id}`},
        {n: 'SERVER 2', u: `https://vidsrc.me/embed/${type}?tmdb=${id}`},
        {n: 'SERVER 3', u: `https://player.autoembed.cc/embed/${type}/${id}`},
        {n: 'SERVER 4', u: `https://multiembed.mov/?video_id=${id}&tmdb=1`},
        {n: 'SERVER 5', u: `https://embed.su/embed/${type}/${id}`},
        {n: 'SERVER 6', u: `https://vidsrc.cc/v2/embed/${type}/${id}`}
    ];
    
    document.getElementById('server-list').innerHTML = servers.map((s, index) => `
        <button onclick="changeServer(this, '${s.u}')" class="server-btn relative overflow-hidden group py-3 px-2 rounded-xl border border-white/5 bg-white/[0.03] backdrop-blur-md transition-all duration-300 active:scale-95">
            <div class="relative z-10 flex flex-col items-center gap-1">
                <span class="text-[8px] font-black text-gray-500 tracking-widest uppercase">Server</span>
                <span class="text-[10px] font-black text-white/80 tracking-tighter">${index + 1}</span>
            </div>
            <div class="server-indicator absolute bottom-0 left-0 right-0 h-[2px] bg-gradient-to-r from-[#bf953f] to-[#aa771c] opacity-0"></div>
        </button>
    `).join('');

    setTimeout(() => { document.querySelector('.server-btn').click(); }, 100);
    renderRecommendations();
}

function changeServer(btn, url) {
    document.getElementById('ultra-player').src = url;
    document.querySelectorAll('.server-btn').forEach(b => {
        b.classList.remove('border-[#bf953f]/50', 'bg-white/[0.08]');
        b.querySelector('.server-indicator').classList.add('opacity-0');
    });
    btn.classList.add('border-[#bf953f]/50', 'bg-white/[0.08]');
    btn.querySelector('.server-indicator').classList.remove('opacity-0');
}

function closePlayer() {
    document.getElementById('player-screen').classList.add('hidden');
    document.getElementById('ultra-player').src = '';
}

function shareMovie() {
    // 1. Pastikan ID film tersedia
    if (!currentPlayingId) {
        alert("Pilih film terlebih dahulu!");
        return;
    }

    // 2. Buat Link Tautan mengarah ke Vercel kamu
    // Ganti 'giga21.vercel.app' dengan domain asli yang diberikan Vercel
    const shareUrl = `https://giga21.vercel.app/${currentPlayingId}`;
    
    // 3. Ambil Judul Film untuk teks pesan
    const movieTitle = document.getElementById('player-title').innerText;

    // 4. Logika Berbagi
    if (navigator.share) {
        // Jika dibuka di HP (WhatsApp, Telegram, dll)
        navigator.share({
            title: 'BURUAN NONTON SEBELUM DIHAPUS !!',
            text: `FILM: ${movieTitle}. Hanya di GIGA21 Streaming gratis tanpa batas.`,
            url: shareUrl
        }).catch(console.error);
    } else {
        // Jika dibuka di Laptop (Copy to Clipboard)
        navigator.clipboard.writeText(shareUrl);
        alert("Link cantik berhasil disalin! Silakan bagikan.");
    }
}

function toggleFavoriteHero() {
    const btn = document.getElementById('btn-save-hero');
    const icon = btn.querySelector('i');
    if (icon.classList.contains('fa-plus')) {
        icon.classList.replace('fa-plus', 'fa-check'); icon.classList.add('gold-text');
        btn.classList.add('border-[#bf953f]/50');
    } else {
        icon.classList.replace('fa-check', 'fa-plus'); icon.classList.remove('gold-text');
        btn.classList.remove('border-[#bf953f]/50');
    }
}

function toggleSearch() {
    const overlay = document.getElementById('search-overlay');
    const input = document.getElementById('search-input');
    overlay.classList.toggle('hidden');
    if (overlay.classList.contains('hidden')) {
        input.value = ''; document.getElementById('search-results').innerHTML = '';
        currentEndpoint = '/trending/all/day?'; 
    } else { input.focus(); }
}

function playHero() { 
    if (!featuredId) return;
    openPlayer(featuredId, featuredType); 
}

window.onclick = (e) => { if (!e.target.closest('.relative')) toggleDropdown('none'); };

// --- DOWNLOAD SYSTEM ---
let downloadTimer;
function openDownloadOverlay() {
    const overlay = document.getElementById('download-overlay');
    const timerText = document.getElementById('dl-timer');
    const countdownWrapper = document.getElementById('countdown-text');
    const realBtn = document.getElementById('real-dl-btn');
    document.getElementById('dl-filename').innerText = document.getElementById('player-title').innerText + ".mp4";
    overlay.style.display = 'flex';
    let timeLeft = 15;
    timerText.innerText = timeLeft;
    countdownWrapper.style.display = 'block'; realBtn.style.display = 'none';
    clearInterval(downloadTimer);
    downloadTimer = setInterval(() => {
        timeLeft--; timerText.innerText = timeLeft;
        if (timeLeft <= 0) {
            clearInterval(downloadTimer);
            countdownWrapper.style.display = 'none'; realBtn.style.display = 'block';
        }
    }, 1000);
}

function closeDownloadOverlay() { document.getElementById('download-overlay').style.display = 'none'; clearInterval(downloadTimer); }
function triggerDownload() { document.getElementById('download-overlay').style.display = 'none'; document.getElementById('gateway-overlay').classList.remove('hidden'); }
function closeGateway() { document.getElementById('gateway-overlay').classList.add('hidden'); }

function goToFinalDownload(quality, size) {
    const title = document.getElementById('player-title').innerText;
    const cleanTitle = encodeURIComponent(title + " [" + quality + "]");
    const downloadURL = `d.html?f=${cleanTitle}&s=${size}`;
    const qualityList = document.getElementById('quality-list');
    qualityList.innerHTML = `<div class="py-20 text-center"><i class="fas fa-circle-notch fa-spin gold-text text-3xl mb-4"></i><p class="text-[10px] gold-text font-black uppercase tracking-widest">Menghubungkan ke Server Cloud...</p></div>`;
    setTimeout(() => { window.location.href = downloadURL; }, 1500);
}

function goToServer(serverName, size) {
    const title = document.getElementById('player-title').innerText;
    window.open('https://practicalboil.com/bvrnh9xigu?key=ba748d14a1fc94f5942aea0574acdd95', '_blank');
    const cleanTitle = encodeURIComponent(title + " [" + serverName + "]");
    window.location.href = `d.html?f=${cleanTitle}&s=${size}`;
}

// Jalankan App
initApp();
</script>
</body>
</html>
